#!/usr/bin/env bash
# kurbeScript - Set up and verify a local Kubernetes cluster using Minikube

set -e  # Exit on error
set -o pipefail

echo "ğŸ” Checking for Minikube installation..."

if ! command -v minikube &> /dev/null; then
    echo "âš ï¸ Minikube is not installed. Installing Minikube..."

    # Detect OS for installation
    OS=$(uname -s)
    case "$OS" in
        Linux)
            curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
            sudo install minikube-linux-amd64 /usr/local/bin/minikube
            rm minikube-linux-amd64
            ;;
        Darwin)
            brew install minikube || curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 \
                && sudo install minikube-darwin-amd64 /usr/local/bin/minikube \
                && rm minikube-darwin-amd64
            ;;
        *)
            echo "âŒ Unsupported OS: $OS. Please install Minikube manually."
            exit 1
            ;;
    esac
else
    echo "âœ… Minikube is already installed."
fi

echo "ğŸš€ Starting Minikube cluster..."
minikube start

echo "â³ Verifying Kubernetes cluster status..."
kubectl cluster-info

echo "ğŸ“¦ Listing current pods..."
kubectl get pods --all-namespaces

echo "âœ… Kubernetes local cluster setup complete!"
